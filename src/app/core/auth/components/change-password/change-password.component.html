<div class="container d-flex justify-content-center align-items-center vh-100">

    

   @if(showChangePassword()){

    <ng-container>
      <div class="card shadow-lg" style="width: 100%; max-width: 400px;">
        <div class="card-body p-4">
          <h2 class="text-center mb-4">{{ 'changePassword.title' | translate }}</h2>
          <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" autocomplete="off">
            
            @if(enableOldPassword()){
              <div class="form-floating mb-3">
                <input
                  [type]="showPassword ? 'text' : 'password'"
                  formControlName="oldPassword"
                  class="form-control"
                  [placeholder]="'changePassword.oldPassword.placeholder' | translate"
                  [class.is-invalid]="formUtils.isValidField(changePasswordForm, 'oldPassword')"

                />
                <label for="oldPassword">{{ 'changePassword.oldPassword.label' | translate }}</label>
                @if(changePasswordForm.get('oldPassword')!.invalid && changePasswordForm.get('oldPassword')!.touched) {
                  <div class="invalid-feedback">
                    @if(changePasswordForm.get('oldPassword')?.errors?.['required']) {
                      <div>{{ 'changePassword.errors.oldPassword.required' | translate }}</div>
                    }
                  </div>
                }
              </div>
            }

            <div class="form-floating mb-3">
              <input
                [type]="showPassword ? 'text' : 'password'"
                id="newPassword"
                formControlName="newPassword"
                class="form-control"
                placeholder="{{ 'changePassword.newPassword.placeholder' | translate }}"
                [class.is-invalid]="formUtils.isValidField(changePasswordForm, 'newPassword')"
                (input)="onPasswordInput()"
              />
              
              <label for="newPassword">{{ 'changePassword.newPassword.label' | translate }}</label>
            
              @if(changePasswordForm.get('newPassword')!.invalid && changePasswordForm.get('newPassword')!.touched) {
                <div class="invalid-feedback">
                  @if(changePasswordForm.get('newPassword')?.errors?.['required']) {
                    <div>{{ 'changePassword.errors.newPassword.required' | translate }}</div>
                  }
                  @if(changePasswordForm.get('newPassword')?.errors?.['minlength']) {
                    <div>{{ 'changePassword.errors.newPassword.minLength' | translate }}</div>
                  }
                  @if(changePasswordForm.get('newPassword')?.errors?.['pattern']) {
                    <div>{{ 'changePassword.errors.newPassword.pattern' | translate }}</div>
                  }
                  @if(changePasswordForm.get('newPassword')?.errors?.['repeatedChars']) {
                    <div>{{ 'changePassword.errors.newPassword.repeatedChars' | translate }}</div>
                  }
                  @if(changePasswordForm.get('newPassword')?.errors?.['passwordHistory']) {
                    <div>{{ 'changePassword.errors.newPassword.passwordHistory' | translate }}</div>
                  }
                </div>
              }
              
            </div>
            
    
            <div class="alert alert-info p-2 small">
              <div class="mb-1">{{ 'changePassword.passwordRequirements.title' | translate }}</div>
              <div [class.text-success]="hasMinLength" [class.text-muted]="!hasMinLength">
                ✓ {{ 'changePassword.passwordRequirements.minLength' | translate }}
              </div>
              <div [class.text-success]="hasUpperCase" [class.text-muted]="!hasUpperCase">
                ✓ {{ 'changePassword.passwordRequirements.upperCase' | translate }}
              </div>
              <div [class.text-success]="hasLowerCase" [class.text-muted]="!hasLowerCase">
                ✓ {{ 'changePassword.passwordRequirements.lowerCase' | translate }}
              </div>
              <div [class.text-success]="hasNumber" [class.text-muted]="!hasNumber">
                ✓ {{ 'changePassword.passwordRequirements.number' | translate }}
              </div>
              <div [class.text-success]="hasSpecialChar" [class.text-muted]="!hasSpecialChar">
                ✓ {{ 'changePassword.passwordRequirements.specialChar' | translate }}
              </div>
              <div [class.text-success]="hasNoSpaces" [class.text-muted]="!hasNoSpaces">
                ✓ {{ 'changePassword.passwordRequirements.noSpaces' | translate }}
              </div>
              <div [class.text-success]="hasNoRepeatedChars" [class.text-muted]="!hasNoRepeatedChars">
                ✓ {{ 'changePassword.passwordRequirements.noRepeatedChars' | translate }}
              </div>
            </div>
    
            <div class="form-floating mb-3">
              <input
                  [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                formControlName="confirmPassword"
                class="form-control"
                placeholder="{{ 'changePassword.confirmPassword.placeholder' | translate }}"
                [class.is-invalid]="changePasswordForm.hasError('passwordsMismatch')"
              />
              <label for="confirmPassword">{{ 'changePassword.confirmPassword.label' | translate }}</label>
              @if(changePasswordForm.hasError('passwordsMismatch')) {
                <div class="invalid-feedback">
                  {{ 'changePassword.errors.confirmPassword.mismatch' | translate }}
                </div>
              }
            </div>
    
            <button type="submit" class="btn btn-primary w-100 mb-2" [disabled]="!changePasswordForm.valid">
              {{ 'changePassword.changeButton' | translate }}
            </button>
            <div class="text-center">
              <a routerLink="/auth/login" class="text-decoration-none">{{ 'changePassword.backToLogin' | translate }}</a>
            </div>
          </form>
        </div>
      </div>
    </ng-container>
    
    
   }
   @if(!showChangePassword()){
    <app-sms-code-validation
      [userId]="userId()"
      [phoneNumberEnds]="phoneNumberEnds()"
      (validationComplete)="onValidationComplete($event)"
    ></app-sms-code-validation>
   }
  </div>